sudo: required
dist: trusty
language: generic

branches:
  except:
    - gh-pages

env:

env:
  # This will check any ROS distro with any python interpreter
  # supported on this OS
  - CI_ROS_DISTRO=indigo ROS_FLOW=devel
  # Pyros is released as a pip package as well as a ros deb package : dependencies should work from install space as well
  - CI_ROS_DISTRO=indigo ROS_FLOW=install
  - CI_ROS_DISTRO=indigo PYTHON=2.7
  - CI_ROS_DISTRO=indigo PYTHON=3.4

  - CI_ROS_DISTRO=jade ROS_FLOW=devel
  # Pyros is released as a pip package as well as a ros deb package : dependencies should work from install space as well
  - CI_ROS_DISTRO=jade ROS_FLOW=install
  - CI_ROS_DISTRO=jade PYTHON=2.7
  - CI_ROS_DISTRO=jade PYTHON=3.4
  # TODO : pypy + pypy3


# We need to get a ROS distro to be able to test pyros
# from different ros environments, or
# from different virtualenv using site-packages.
before_install:
  # Install ROS. We always need it for testing on system.
  - bash rosutils/install_ros.sh
  # Install python and required packages on system if needed
  - if [ -z ${PYTHON+undef} ]; then echo "Python virtual env not used"; else sudo apt-get install python${PYTHON} virtualenvwrapper -y && source "/usr/share/virtualenvwrapper/virtualenvwrapper.sh"; fi
  # Install package ROS dependencies
  - rosdep install --default-yes --from-paths ./ --rosdistro $CI_ROS_DISTRO


install:
  - if [ -z ${PYTHON+undef} ]; then (bash rosutils/travis_build.sh); else (mkvirtualenv --system-site-packages -i . -q python_${PYTHON}_ros); fi

script:
  # TODO : we need to call nose with --exe here to NOT SKIP tests (but will need to guarantee process isolation)
  - if [ -z ${PYTHON+undef} ]; then (bash rosutils/travis_checks.sh); else (workon python_${PYTHON}_ros && python -m nose pyros -s); fi

notifications:
  email: false
